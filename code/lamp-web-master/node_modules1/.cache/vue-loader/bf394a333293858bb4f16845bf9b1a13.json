{"remainingRequest":"E:\\project\\lamp-web-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\project\\lamp-web-master\\src\\views\\login\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\project\\lamp-web-master\\src\\views\\login\\index.vue","mtime":1689066038772},{"path":"E:\\project\\lamp-web-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686711136315},{"path":"E:\\project\\lamp-web-master\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1686711135008},{"path":"E:\\project\\lamp-web-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1686711137609},{"path":"E:\\project\\lamp-web-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686711136315},{"path":"E:\\project\\lamp-web-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1686711137115}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport LangSelect from \"@/components/LangSelect\";\nimport db from \"@/utils/localstorage\";\nimport {randomNum} from \"@/utils\";\nimport {socialLoginUrl} from \"@/settings\";\nimport loginApi from \"@/api/Login.js\";\nimport {Base64} from \"js-base64\";\n\nexport default {\n  name: \"Login\",\n  components: {LangSelect},\n  data() {\n    return {\n      //是否启用多租户\n      isMultiTenant: process.env.VUE_APP_IS_MULTI_TENANT_TYPE !== \"NONE\",\n      isCaptcha: process.env.VUE_APP_IS_CAPTCHA === \"true\",\n      tabActiveName: \"bindLogin\",\n      login: {\n        type: \"up\"\n      },\n      // 第三方登陆的选择\n      logo: [\n        {img: \"gitee.png\", name: \"gitee\", radius: true},\n        {img: \"github.png\", name: \"github\", radius: true},\n        {img: \"tencent_cloud.png\", name: \"tencent_cloud\", radius: true},\n        {img: \"qq.png\", name: \"qq\", radius: false},\n        {img: \"dingtalk.png\", name: \"dingtalk\", radius: true},\n        {img: \"microsoft.png\", name: \"microsoft\", radius: false}\n      ],\n      loginForm: {\n        account: \"lamp\",\n        password: \"lamp\",\n        tenantView: \"0000\", //显示用的\n        tenant: \"\", //传递给后端的\n        key: randomNum(24, 16),\n        code: \"\",\n        grantType:\n          process.env.VUE_APP_IS_CAPTCHA === \"true\" ? \"captcha\" : \"password\",\n        bindAccount: \"\",\n        bindPassword: \"\",\n        signAccount: \"\",\n        signPassword: \"\"\n      },\n      rules: {\n        account: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        tenantView: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        password: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        code: {\n          validator: (rule, value, callback) => {\n            if (this.isCaptcha && value === \"\") {\n              callback(\"验证码不能为空\");\n            } else {\n              callback();\n            }\n            callback();\n          },\n          trigger: \"blur\"\n        },\n        bindAccount: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        bindPassword: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        signAccount: [\n          {\n            required: true,\n            message: this.$t(\"rules.require\"),\n            trigger: \"blur\"\n          },\n          {\n            min: 4,\n            max: 10,\n            message: this.$t(\"rules.range4to10\"),\n            trigger: \"blur\"\n          }\n        ],\n        signPassword: [\n          {\n            required: true,\n            message: this.$t(\"rules.require\"),\n            trigger: \"blur\"\n          },\n          {\n            min: 6,\n            max: 20,\n            message: this.$t(\"rules.range6to20\"),\n            trigger: \"blur\"\n          }\n        ]\n      },\n      authUser: null,\n      loading: false,\n      showDialog: false,\n      redirect: undefined,\n      otherQuery: {},\n      imageCode: \"\",\n      page: {\n        width: window.screen.width * 0.5,\n        height: window.screen.height * 0.5\n      }\n    };\n  },\n  created() {\n  },\n  mounted() {\n    db.clear();\n    this.getCodeImage();\n  },\n  destroyed() {\n    window.removeEventListener(\"message\", this.resolveSocialLogin);\n  },\n  methods: {\n    getCodeImage() {\n      if (this.isCaptcha) {\n        loginApi\n          .getCaptcha(this.loginForm.key)\n          .then(response => {\n            const res = response.data;\n            if (res.byteLength <= 100) {\n              this.$message({\n                message: this.$t(\"tips.systemError\"),\n                type: \"error\"\n              });\n            }\n            return (\n              \"data:image/png;base64,\" +\n              btoa(\n                new Uint8Array(res).reduce(\n                  (data, byte) => data + String.fromCharCode(byte),\n                  \"\"\n                )\n              )\n            );\n          })\n          .then(res => {\n            this.imageCode = res;\n          })\n          .catch(e => {\n            if (e.toString().indexOf(\"429\") !== -1) {\n              this.$message({\n                message: this.$t(\"tips.tooManyRequest\"),\n                type: \"error\"\n              });\n            } else {\n              this.$message({\n                message: this.$t(\"tips.getCodeImageFailed\"),\n                type: \"error\"\n              });\n            }\n          });\n      }\n    },\n    handleTabClick(tab) {\n      this.tabActiveName = tab.name;\n    },\n    resolveLogo(logo) {\n      return require(`@/assets/logo/${logo}`);\n    },\n    socialLogin(oauthType) {\n      const url = `${socialLoginUrl}/${oauthType}/login`;\n      window.open(\n        url,\n        \"newWindow\",\n        `resizable=yes, height=${this.page.height}, width=${this.page.width}, top=10%, left=10%, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no, status=no`\n      );\n      window.addEventListener(\"message\", this.resolveSocialLogin, false);\n    },\n    resolveSocialLogin(e) {\n      const data = e.data;\n      const that = this;\n      if (data.message === \"not_bind\") {\n        that.login.type = \"bind\";\n        const authUser = data.data;\n        that.authUser = authUser;\n        that\n          .$confirm(\n            that.$t(\"common.current\") +\n            authUser.source +\n            that.$t(\"common.socialAccount\") +\n            authUser.nickname +\n            that.$t(\"common.socialTips\"),\n            that.$t(\"common.tips\"),\n            {\n              confirmButtonText: that.$t(\"common.signLogin\"),\n              cancelButtonText: that.$t(\"common.bindLogin\"),\n              type: \"warning\"\n            }\n          )\n          .then(() => {\n            that.tabActiveName = \"signLogin\";\n          })\n          .catch(() => {\n            that.tabActiveName = \"bindLogin\";\n          });\n      } else if (data.message === \"social_login_success\") {\n        that.saveLoginData(data.data);\n        that.getUserDetailInfo();\n        that.loginSuccessCallback(data.account);\n      } else {\n        // do nothing\n      }\n    },\n    bindLogin() {\n      let account_c = false;\n      let password_c = false;\n      this.$refs.loginForm.validateField(\"bindAccount\", e => {\n        if (!e) {\n          account_c = true;\n        }\n      });\n      this.$refs.loginForm.validateField(\"bindPassword\", e => {\n        if (!e) {\n          password_c = true;\n        }\n      });\n      if (account_c && password_c) {\n        this.loading = true;\n        const that = this;\n        const params = {\n          bindAccount: that.loginForm.bindAccount,\n          bindPassword: that.loginForm.bindPassword,\n          ...that.authUser\n        };\n        params.token = null;\n        that\n          .$post(\"auth/social/bind/login\", params)\n          .then(r => {\n            const data = r.data.data;\n            this.saveLoginData(data);\n            this.getUserDetailInfo();\n            this.loginSuccessCallback(that.loginForm.bindAccount);\n          })\n          .catch(error => {\n            console.error(error);\n            that.loading = false;\n          });\n      }\n    },\n    signLogin() {\n      let account_c = false;\n      let password_c = false;\n      this.$refs.loginForm.validateField(\"signAccount\", e => {\n        if (!e) {\n          account_c = true;\n        }\n      });\n      this.$refs.loginForm.validateField(\"signPassword\", e => {\n        if (!e) {\n          password_c = true;\n        }\n      });\n      if (account_c && password_c) {\n        this.loading = true;\n        const that = this;\n        const params = {\n          bindAccount: that.loginForm.signAccount,\n          bindPassword: that.loginForm.signPassword,\n          ...that.authUser\n        };\n        params.token = null;\n        that\n          .$post(\"auth/social/sign/login\", params)\n          .then(r => {\n            const data = r.data.data;\n            this.saveLoginData(data);\n            this.getUserDetailInfo();\n            this.loginSuccessCallback(that.loginForm.signAccount);\n          })\n          .catch(error => {\n            console.error(error);\n            that.loading = false;\n          });\n      }\n    },\n    handleLogin() {\n      this.loginForm.tenant = `${Base64.encode(this.loginForm.tenantView)}`;\n      this.$refs.loginForm.validate(valid => {\n        if (valid) {\n          this.loginSubmit();\n        } else {\n          return false;\n        }\n      });\n    },\n    loginSubmit() {\n      this.loading = true;\n      const that = this;\n      this.$store.commit(\"account/setTenant\", this.loginForm.tenant);\n      loginApi\n        .login(this.loginForm, {tenant: this.loginForm.tenant, \"X-isTenant\": false})\n        .then(response => {\n          const res = response.data;\n          if (res.isSuccess) {\n            that.saveLoginData(\n              res.data[\"token\"],\n              res.data[\"refreshToken\"],\n              res.data[\"expiration\"]\n            );\n            that.saveUserInfo(res.data);\n            that.getResource();\n          } else {\n            that.getCodeImage();\n          }\n        })\n        .catch(() => {\n          // if(error.response.data){\n          //   this.$message({\n          //     message: error.response.data.msg,\n          //     type: \"error\"\n          //   });\n          // }\n          that.getCodeImage();\n        })\n        .finally(() => (that.loading = false));\n    },\n    saveLoginData(token, refreshToken, expiration) {\n      this.$store.commit(\"account/setToken\", token);\n      this.$store.commit(\"account/setRefreshToken\", refreshToken);\n      this.$store.commit(\"account/setExpireTime\", expiration);\n    },\n    saveUserInfo(user) {\n      this.$store.commit(\"account/setUser\", {\n        id: user.userId,\n        account: user.account,\n        name: user.name,\n        avatar: user.avatar,\n        workDescribe: user.workDescribe\n      });\n    },\n    getResource() {\n      loginApi.getResource().then(response => {\n        const res = response.data;\n        if (res.isSuccess) {\n          const authorityResource = res.data;\n          const permissionsList = authorityResource.resourceList || [];\n\n          this.$store.commit(\"account/setPermissions\", permissionsList);\n          this.$store.commit(\"account/setAuthorityResource\", authorityResource);\n\n          this.loginSuccess();\n        } else {\n          this.getCodeImage();\n        }\n      });\n    },\n    loginSuccess() {\n      this.$message({\n        message: this.$t(\"tips.loginSuccess\"),\n        type: \"success\"\n      });\n      this.$router.push(\"/\");\n    },\n    loginSuccessCallback(user) {\n      console.log(user);\n    }\n  }\n};\n",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2SA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/login","sourcesContent":["<!-- -->\n<template>\n  <div class=\"login-container\">\n    <!--    左侧文字-->\n    <div class=\"login-info\">\n<!--      <div class=\"title\">-->\n<!--        lamp-web-->\n<!--      </div>-->\n      <div class=\"title\">\n        {{ $t(\"common.system\") }}\n      </div>\n<!--      <div class=\"desc\">-->\n<!--        1. {{ $t(\"common.desc.a\") }}-->\n<!--      </div>-->\n<!--      <div class=\"desc\">-->\n<!--        2. {{ $t(\"common.desc.b\") }}-->\n<!--      </div>-->\n<!--      <div class=\"desc\">-->\n<!--        3. {{ $t(\"common.desc.c\") }}-->\n<!--      </div>-->\n<!--      <div class=\"desc\">-->\n<!--        4. {{ $t(\"common.desc.d\") }}-->\n<!--      </div>-->\n<!--      <div class=\"desc\">-->\n<!--        5. {{ $t(\"common.desc.e\") }}-->\n<!--      </div>-->\n<!--      <div class=\"desc\">-->\n<!--        6. {{ $t(\"common.desc.f\") }}-->\n<!--      </div>-->\n      <div class=\"desc\">\n        演示账号： 平台管理员： lamp_pt/lamp (内置给公司内部运营人员使用)\n      </div>\n      <div class=\"desc\">\n        演示账号： 超级管理员： lamp/lamp\n      </div>\n      <div class=\"desc\">\n        演示账号： 普通管理员： general/lamp\n      </div>\n      <div class=\"desc\">\n        演示账号： 普通账号： normal/lamp\n      </div>\n<!--      <div class=\"desc\">-->\n<!--        8. 源码：-->\n<!--        <a-->\n<!--          href=\"https://github.com/zuihou\"-->\n<!--          target=\"_blank\"-->\n<!--        >github</a>、-->\n<!--        <a-->\n<!--          href=\"https://gitee.com/zuihou111\"-->\n<!--          target=\"_blank\"-->\n<!--        >gitee</a>-->\n<!--      </div>-->\n    </div>\n\n    <!--    // 登陆表格-->\n    <el-form\n      ref=\"loginForm\"\n      :model=\"loginForm\"\n      :rules=\"rules\"\n      autocomplete=\"off\"\n      class=\"login-form\"\n      label-position=\"left\"\n    >\n      <!--      表头与语言选项-->\n      <div class=\"title-container\">\n        <h3 class=\"title\">\n          {{ $t(\"login.title\") }}\n        </h3>\n        <lang-select class=\"set-language\" />\n      </div>\n\n      <!--  账户密码登陆-->\n      <span v-if=\"login.type === 'up'\">\n\n        <el-form-item\n          v-show=\"isMultiTenant\"\n          prop=\"tenant\"\n        >\n          <el-input\n            ref=\"tenant\"\n            :placeholder=\"$t('login.tenant')\"\n            v-model=\"loginForm.tenantView\"\n            autocomplete=\"off\"\n            name=\"tenantView\"\n            prefix-icon=\"el-icon-user\"\n            type=\"text\"\n            @keyup.enter.native=\"handleLogin\"\n          />\n        </el-form-item>\n\n        <!--        用户名-->\n        <el-form-item prop=\"account\">\n          <el-input\n            ref=\"account\"\n            :placeholder=\"$t('login.username')\"\n            v-model=\"loginForm.account\"\n            autocomplete=\"off\"\n            name=\"account\"\n            prefix-icon=\"el-icon-user\"\n            type=\"text\"\n            @keyup.enter.native=\"handleLogin\"\n          />\n        </el-form-item>\n\n        <!--        密码-->\n        <el-form-item prop=\"password\">\n          <el-input\n            ref=\"password\"\n            :placeholder=\"$t('login.password')\"\n            :show-password=\"true\"\n            v-model=\"loginForm.password\"\n            autocomplete=\"off\"\n            name=\"password\"\n            prefix-icon=\"el-icon-key\"\n            type=\"password\"\n            @keyup.enter.native=\"handleLogin\"\n          />\n        </el-form-item>\n\n        <!--        验证码-->\n        <el-form-item\n          v-show=\"isCaptcha\"\n          class=\"code-input\"\n          prop=\"code\"\n        >\n          <el-input\n            ref=\"code\"\n            :placeholder=\"$t('login.code')\"\n            autocomplete=\"off\"\n            name=\"code\"\n            v-model=\"loginForm.code\"\n            prefix-icon=\"el-icon-lock\"\n            style=\"width: 70%\"\n            type=\"text\"\n            @keyup.enter.native=\"handleLogin\"\n          />\n        </el-form-item>\n\n        <!--        验证码图片-->\n        <img\n          v-show=\"isCaptcha\"\n          :src=\"imageCode\"\n          alt=\"codeImage\"\n          class=\"code-image\"\n          @click=\"getCodeImage\"\n        >\n\n        <!--        登陆按钮-->\n        <el-button\n          :loading=\"loading\"\n          style=\"width:100%;margin-bottom:14px;\"\n          type=\"primary\"\n          @click.native.prevent=\"handleLogin\"\n        >{{ $t(\"login.logIn\") }}</el-button>\n      </span>\n\n      <!--      第三方登陆-->\n      <span v-if=\"login.type === 'social'\">\n        {{ $t(\"login.chooseToSignIn\") }}\n        <div>\n          <template v-for=\"(l, index) in logo\">\n            <div\n              :key=\"index\"\n              class=\"logo-wrapper\"\n            >\n              <img\n                :class=\"{ radius: l.radius }\"\n                :src=\"resolveLogo(l.img)\"\n                alt\n                @click=\"socialLogin(l.name)\"\n              >\n            </div>\n          </template>\n        </div>\n      </span>\n\n      <!--      登陆方式选择-->\n      <span\n        v-if=\"login.type === 'bind'\"\n        style=\"margin-top: -1rem\"\n      >\n        <el-tabs\n          v-model=\"tabActiveName\"\n          @tab-click=\"handleTabClick\"\n        >\n          <el-tab-pane\n            :label=\"$t('common.bindLogin')\"\n            name=\"bindLogin\"\n          >\n            <el-form-item prop=\"bindAccount\">\n              <el-input\n                ref=\"bindAccount\"\n                v-model=\"loginForm.bindAccount\"\n                :placeholder=\"$t('login.account')\"\n                autocomplete=\"off\"\n                name=\"bindAccount\"\n                prefix-icon=\"el-icon-user\"\n                type=\"text\"\n              />\n            </el-form-item>\n            <el-form-item prop=\"bindPassword\">\n              <el-input\n                ref=\"bindPassword\"\n                v-model=\"loginForm.bindPassword\"\n                :placeholder=\"$t('login.password')\"\n                :show-password=\"true\"\n                autocomplete=\"off\"\n                name=\"bindPassword\"\n                prefix-icon=\"el-icon-key\"\n                type=\"password\"\n              />\n            </el-form-item>\n            <el-button\n              :loading=\"loading\"\n              style=\"width:100%;margin-bottom:14px;\"\n              type=\"primary\"\n              @click.native.prevent=\"bindLogin\"\n            >{{ $t(\"common.bindLogin\") }}</el-button>\n          </el-tab-pane>\n          <el-tab-pane\n            :label=\"$t('common.signLogin')\"\n            name=\"signLogin\"\n          >\n            <el-form-item prop=\"signAccount\">\n              <el-input\n                ref=\"signAccount\"\n                v-model=\"loginForm.signAccount\"\n                :placeholder=\"$t('login.account')\"\n                autocomplete=\"off\"\n                name=\"signAccount\"\n                prefix-icon=\"el-icon-user\"\n                type=\"text\"\n              />\n            </el-form-item>\n            <el-form-item prop=\"signPassword\">\n              <el-input\n                ref=\"signPassword\"\n                v-model=\"loginForm.signPassword\"\n                :placeholder=\"$t('login.password')\"\n                :show-password=\"true\"\n                autocomplete=\"off\"\n                name=\"signPassword\"\n                prefix-icon=\"el-icon-key\"\n                type=\"password\"\n              />\n            </el-form-item>\n            <el-button\n              :loading=\"loading\"\n              style=\"width:100%;margin-bottom:14px;\"\n              type=\"primary\"\n              @click.native.prevent=\"signLogin\"\n            >{{ $t(\"common.signLogin\") }}</el-button>\n          </el-tab-pane>\n        </el-tabs>\n      </span>\n\n      <el-dropdown\n        class=\"login-type\"\n        placement=\"top-end\"\n      >\n        <span class=\"el-dropdown-link\">\n          <el-link type=\"primary\">{{ $t(\"login.ortherLoginType\") }}</el-link>\n        </span>\n        <el-dropdown-menu slot=\"dropdown\">\n          <el-dropdown-item\n            :disabled=\"login.type === 'up'\"\n            @click.native=\"login.type = 'up'\"\n          >\n            {{ $t(\"login.type.up\") }}\n          </el-dropdown-item>\n          <el-dropdown-item\n            :disabled=\"login.type === 'social'\"\n            @click.native=\"login.type = 'social'\"\n          >\n            {{ $t(\"login.type.social\") }}\n          </el-dropdown-item>\n        </el-dropdown-menu>\n      </el-dropdown>\n    </el-form>\n\n  <!--\n    // github\n    <span class=\"login-footer\">\n      © 2019 - 2021\n      <a href=\"https://github.com/zuihou\" target=\"_blank\">zuihou</a> -\n      ai平台\n    </span>\n\n    // 网络备案\n    <div class=\"copyright\">\n      <a target=\"_blank\" href=\"https://beian.miit.gov.cn\"\n      ><img src=\"@/assets/gongan.png\" /><span>黔ICP备2021004749号</span></a\n      >\n    </div>\n-->\n  </div>\n</template>\n\n<script>\nimport LangSelect from \"@/components/LangSelect\";\nimport db from \"@/utils/localstorage\";\nimport {randomNum} from \"@/utils\";\nimport {socialLoginUrl} from \"@/settings\";\nimport loginApi from \"@/api/Login.js\";\nimport {Base64} from \"js-base64\";\n\nexport default {\n  name: \"Login\",\n  components: {LangSelect},\n  data() {\n    return {\n      //是否启用多租户\n      isMultiTenant: process.env.VUE_APP_IS_MULTI_TENANT_TYPE !== \"NONE\",\n      isCaptcha: process.env.VUE_APP_IS_CAPTCHA === \"true\",\n      tabActiveName: \"bindLogin\",\n      login: {\n        type: \"up\"\n      },\n      // 第三方登陆的选择\n      logo: [\n        {img: \"gitee.png\", name: \"gitee\", radius: true},\n        {img: \"github.png\", name: \"github\", radius: true},\n        {img: \"tencent_cloud.png\", name: \"tencent_cloud\", radius: true},\n        {img: \"qq.png\", name: \"qq\", radius: false},\n        {img: \"dingtalk.png\", name: \"dingtalk\", radius: true},\n        {img: \"microsoft.png\", name: \"microsoft\", radius: false}\n      ],\n      loginForm: {\n        account: \"lamp\",\n        password: \"lamp\",\n        tenantView: \"0000\", //显示用的\n        tenant: \"\", //传递给后端的\n        key: randomNum(24, 16),\n        code: \"\",\n        grantType:\n          process.env.VUE_APP_IS_CAPTCHA === \"true\" ? \"captcha\" : \"password\",\n        bindAccount: \"\",\n        bindPassword: \"\",\n        signAccount: \"\",\n        signPassword: \"\"\n      },\n      rules: {\n        account: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        tenantView: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        password: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        code: {\n          validator: (rule, value, callback) => {\n            if (this.isCaptcha && value === \"\") {\n              callback(\"验证码不能为空\");\n            } else {\n              callback();\n            }\n            callback();\n          },\n          trigger: \"blur\"\n        },\n        bindAccount: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        bindPassword: {\n          required: true,\n          message: this.$t(\"rules.require\"),\n          trigger: \"blur\"\n        },\n        signAccount: [\n          {\n            required: true,\n            message: this.$t(\"rules.require\"),\n            trigger: \"blur\"\n          },\n          {\n            min: 4,\n            max: 10,\n            message: this.$t(\"rules.range4to10\"),\n            trigger: \"blur\"\n          }\n        ],\n        signPassword: [\n          {\n            required: true,\n            message: this.$t(\"rules.require\"),\n            trigger: \"blur\"\n          },\n          {\n            min: 6,\n            max: 20,\n            message: this.$t(\"rules.range6to20\"),\n            trigger: \"blur\"\n          }\n        ]\n      },\n      authUser: null,\n      loading: false,\n      showDialog: false,\n      redirect: undefined,\n      otherQuery: {},\n      imageCode: \"\",\n      page: {\n        width: window.screen.width * 0.5,\n        height: window.screen.height * 0.5\n      }\n    };\n  },\n  created() {\n  },\n  mounted() {\n    db.clear();\n    this.getCodeImage();\n  },\n  destroyed() {\n    window.removeEventListener(\"message\", this.resolveSocialLogin);\n  },\n  methods: {\n    getCodeImage() {\n      if (this.isCaptcha) {\n        loginApi\n          .getCaptcha(this.loginForm.key)\n          .then(response => {\n            const res = response.data;\n            if (res.byteLength <= 100) {\n              this.$message({\n                message: this.$t(\"tips.systemError\"),\n                type: \"error\"\n              });\n            }\n            return (\n              \"data:image/png;base64,\" +\n              btoa(\n                new Uint8Array(res).reduce(\n                  (data, byte) => data + String.fromCharCode(byte),\n                  \"\"\n                )\n              )\n            );\n          })\n          .then(res => {\n            this.imageCode = res;\n          })\n          .catch(e => {\n            if (e.toString().indexOf(\"429\") !== -1) {\n              this.$message({\n                message: this.$t(\"tips.tooManyRequest\"),\n                type: \"error\"\n              });\n            } else {\n              this.$message({\n                message: this.$t(\"tips.getCodeImageFailed\"),\n                type: \"error\"\n              });\n            }\n          });\n      }\n    },\n    handleTabClick(tab) {\n      this.tabActiveName = tab.name;\n    },\n    resolveLogo(logo) {\n      return require(`@/assets/logo/${logo}`);\n    },\n    socialLogin(oauthType) {\n      const url = `${socialLoginUrl}/${oauthType}/login`;\n      window.open(\n        url,\n        \"newWindow\",\n        `resizable=yes, height=${this.page.height}, width=${this.page.width}, top=10%, left=10%, toolbar=no, menubar=no, scrollbars=no, resizable=no,location=no, status=no`\n      );\n      window.addEventListener(\"message\", this.resolveSocialLogin, false);\n    },\n    resolveSocialLogin(e) {\n      const data = e.data;\n      const that = this;\n      if (data.message === \"not_bind\") {\n        that.login.type = \"bind\";\n        const authUser = data.data;\n        that.authUser = authUser;\n        that\n          .$confirm(\n            that.$t(\"common.current\") +\n            authUser.source +\n            that.$t(\"common.socialAccount\") +\n            authUser.nickname +\n            that.$t(\"common.socialTips\"),\n            that.$t(\"common.tips\"),\n            {\n              confirmButtonText: that.$t(\"common.signLogin\"),\n              cancelButtonText: that.$t(\"common.bindLogin\"),\n              type: \"warning\"\n            }\n          )\n          .then(() => {\n            that.tabActiveName = \"signLogin\";\n          })\n          .catch(() => {\n            that.tabActiveName = \"bindLogin\";\n          });\n      } else if (data.message === \"social_login_success\") {\n        that.saveLoginData(data.data);\n        that.getUserDetailInfo();\n        that.loginSuccessCallback(data.account);\n      } else {\n        // do nothing\n      }\n    },\n    bindLogin() {\n      let account_c = false;\n      let password_c = false;\n      this.$refs.loginForm.validateField(\"bindAccount\", e => {\n        if (!e) {\n          account_c = true;\n        }\n      });\n      this.$refs.loginForm.validateField(\"bindPassword\", e => {\n        if (!e) {\n          password_c = true;\n        }\n      });\n      if (account_c && password_c) {\n        this.loading = true;\n        const that = this;\n        const params = {\n          bindAccount: that.loginForm.bindAccount,\n          bindPassword: that.loginForm.bindPassword,\n          ...that.authUser\n        };\n        params.token = null;\n        that\n          .$post(\"auth/social/bind/login\", params)\n          .then(r => {\n            const data = r.data.data;\n            this.saveLoginData(data);\n            this.getUserDetailInfo();\n            this.loginSuccessCallback(that.loginForm.bindAccount);\n          })\n          .catch(error => {\n            console.error(error);\n            that.loading = false;\n          });\n      }\n    },\n    signLogin() {\n      let account_c = false;\n      let password_c = false;\n      this.$refs.loginForm.validateField(\"signAccount\", e => {\n        if (!e) {\n          account_c = true;\n        }\n      });\n      this.$refs.loginForm.validateField(\"signPassword\", e => {\n        if (!e) {\n          password_c = true;\n        }\n      });\n      if (account_c && password_c) {\n        this.loading = true;\n        const that = this;\n        const params = {\n          bindAccount: that.loginForm.signAccount,\n          bindPassword: that.loginForm.signPassword,\n          ...that.authUser\n        };\n        params.token = null;\n        that\n          .$post(\"auth/social/sign/login\", params)\n          .then(r => {\n            const data = r.data.data;\n            this.saveLoginData(data);\n            this.getUserDetailInfo();\n            this.loginSuccessCallback(that.loginForm.signAccount);\n          })\n          .catch(error => {\n            console.error(error);\n            that.loading = false;\n          });\n      }\n    },\n    handleLogin() {\n      this.loginForm.tenant = `${Base64.encode(this.loginForm.tenantView)}`;\n      this.$refs.loginForm.validate(valid => {\n        if (valid) {\n          this.loginSubmit();\n        } else {\n          return false;\n        }\n      });\n    },\n    loginSubmit() {\n      this.loading = true;\n      const that = this;\n      this.$store.commit(\"account/setTenant\", this.loginForm.tenant);\n      loginApi\n        .login(this.loginForm, {tenant: this.loginForm.tenant, \"X-isTenant\": false})\n        .then(response => {\n          const res = response.data;\n          if (res.isSuccess) {\n            that.saveLoginData(\n              res.data[\"token\"],\n              res.data[\"refreshToken\"],\n              res.data[\"expiration\"]\n            );\n            that.saveUserInfo(res.data);\n            that.getResource();\n          } else {\n            that.getCodeImage();\n          }\n        })\n        .catch(() => {\n          // if(error.response.data){\n          //   this.$message({\n          //     message: error.response.data.msg,\n          //     type: \"error\"\n          //   });\n          // }\n          that.getCodeImage();\n        })\n        .finally(() => (that.loading = false));\n    },\n    saveLoginData(token, refreshToken, expiration) {\n      this.$store.commit(\"account/setToken\", token);\n      this.$store.commit(\"account/setRefreshToken\", refreshToken);\n      this.$store.commit(\"account/setExpireTime\", expiration);\n    },\n    saveUserInfo(user) {\n      this.$store.commit(\"account/setUser\", {\n        id: user.userId,\n        account: user.account,\n        name: user.name,\n        avatar: user.avatar,\n        workDescribe: user.workDescribe\n      });\n    },\n    getResource() {\n      loginApi.getResource().then(response => {\n        const res = response.data;\n        if (res.isSuccess) {\n          const authorityResource = res.data;\n          const permissionsList = authorityResource.resourceList || [];\n\n          this.$store.commit(\"account/setPermissions\", permissionsList);\n          this.$store.commit(\"account/setAuthorityResource\", authorityResource);\n\n          this.loginSuccess();\n        } else {\n          this.getCodeImage();\n        }\n      });\n    },\n    loginSuccess() {\n      this.$message({\n        message: this.$t(\"tips.loginSuccess\"),\n        type: \"success\"\n      });\n      this.$router.push(\"/\");\n    },\n    loginSuccessCallback(user) {\n      console.log(user);\n    }\n  }\n};\n</script>\n\n\n<style lang=\"scss\">\n$bg: #fff;\n$light_gray: #fff;\n$cursor: #555;\n\n@supports (-webkit-mask: none) and (not (cater-color: $cursor)) {\n  .login-container .el-input input {\n    color: $cursor;\n  }\n}\n\n/* reset element-ui css */\n.login-container {\n  .el-input {\n    display: inline-block;\n\n    input {\n      background: transparent;\n      border: 0;\n      -webkit-appearance: none;\n      border-radius: 0;\n      color: #000000;\n      height: 28px;\n      caret-color: $cursor;\n\n      &:-webkit-autofill {\n        box-shadow: 0 0 0 1000px $bg inset !important;\n        -webkit-text-fill-color: $cursor !important;\n      }\n    }\n  }\n\n  .el-form-item {\n    border: 1px solid #dedede;\n    border-radius: 2px;\n    color: #454545;\n    transition: all 0.3s;\n\n    &:hover {\n      border-color: #57a3f3;\n    }\n  }\n}\n</style>\n<style lang=\"scss\" scoped>\n$bg: #2d3a4b;\n$dark_gray: #aaa;\n$light_gray: #eee;\n\n.login-container {\n  background: url(../../assets/background.jpg) 50% no-repeat;\n  // background-color: #2d3a4b;\n  background-size: cover;\n  width: 100%;\n  height: 100vh;\n\n  .login-info {\n    position: absolute;\n    left: 15%;\n    top: 44%;\n    margin-top: -100px;\n    color: #fff;\n\n    .title {\n      font-size: 1.8rem;\n      font-weight: 600;\n    }\n\n    .sub-title {\n      font-size: 1.5rem;\n      margin: 0.3rem 0 0.7rem 1rem;\n    }\n\n    .desc {\n      font-size: 0.96rem;\n      line-height: 1.9rem;\n    }\n  }\n\n  .login-form {\n    position: absolute;\n    top: 50%;\n    left: 70%;\n    margin: -180px 0 0 -160px;\n    width: 320px;\n    height: 440px;\n    padding: 36px;\n    background: #fff;\n    border-radius: 3px;\n\n    .code-input {\n      width: 50%;\n      display: inline-block;\n      vertical-align: middle;\n    }\n\n    .code-image {\n      display: inline-block;\n      vertical-align: top;\n      cursor: pointer;\n      height: 42px;\n      width: 115px;\n    }\n\n    .login-type {\n      text-align: right;\n      display: inline-block;\n      width: 100%;\n    }\n\n    .logo-wrapper {\n      display: inline-block;\n      margin: 10px 0;\n\n      img {\n        width: 1.9rem;\n        display: inline-block;\n        margin: 0.8rem 0.8rem -0.8rem 0.8rem;\n        cursor: pointer;\n\n        &.radius {\n          border-radius: 50%;\n        }\n      }\n    }\n  }\n\n  .login-footer {\n    position: fixed;\n    bottom: 2.5rem;\n    width: 100%;\n    text-align: center;\n    color: white;\n    font-size: 0.85rem;\n    line-height: 1rem;\n    height: 1rem;\n  }\n\n  .tips {\n    font-size: 14px;\n    color: #fff;\n    margin-bottom: 10px;\n\n    span {\n      &:first-of-type {\n        margin-right: 16px;\n      }\n    }\n  }\n\n  .title-container {\n    position: relative;\n\n    .title {\n      font-size: 20px;\n      color: rgba(0, 0, 0, 0.85);\n      margin: 0 auto 40px auto;\n      text-align: center;\n      font-weight: bold;\n    }\n\n    .set-language {\n      color: #aaa;\n      position: absolute;\n      top: 3px;\n      font-size: 18px;\n      right: 0;\n      cursor: pointer;\n    }\n  }\n\n  .thirdparty-button {\n    position: absolute;\n    right: 0;\n    bottom: 6px;\n  }\n\n  @media only screen and (max-width: 470px) {\n    .thirdparty-button {\n      display: none;\n    }\n  }\n\n  @media screen and (max-width: 1100px) {\n    .login-info {\n      left: 8%;\n    }\n  }\n\n  @media screen and (max-width: 970px) {\n    .login-form {\n      left: 50%;\n    }\n    .login-info {\n      display: none;\n    }\n  }\n\n  .copyright {\n    position: fixed;\n    bottom: 1rem;\n    width: 100%;\n    text-align: center;\n    color: white;\n    font-size: 0.85rem;\n    line-height: 1rem;\n    height: 1rem;\n\n    a {\n      img {\n        float: left;\n        margin-right: 5px;\n      }\n\n      display: inline-block;\n      margin-right: 10px;\n      margin-left: 10px;\n      color: #939393;\n      vertical-align: bottom;\n    }\n\n    span {\n      color: #939393;\n      vertical-align: bottom;\n    }\n\n    i {\n      margin: 0 4px;\n    }\n  }\n}\n\n</style>\n"]}]}