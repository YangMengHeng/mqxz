{"remainingRequest":"E:\\项目\\lamp-web-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\项目\\lamp-web-master\\src\\components\\lamp\\Import.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\项目\\lamp-web-master\\src\\components\\lamp\\Import.vue","mtime":1679380940000},{"path":"E:\\项目\\lamp-web-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686711136315},{"path":"E:\\项目\\lamp-web-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1686711137609},{"path":"E:\\项目\\lamp-web-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686711136315},{"path":"E:\\项目\\lamp-web-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1686711137115}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport elDragDialog from '@/directive/el-drag-dialog'\nimport fileUpload from \"@/components/lamp/fileUpload\"\n\nexport default {\n  name: 'commonImport',\n  directives: {elDragDialog, fileUpload},\n  components: {fileUpload},\n  props: {\n    action: {\n      type: String,\n      required: true\n    },\n    // 允许上传的文件大小 单位：字节\n    acceptSize: {\n      type: Number,\n      default: 50*1024*1024\n    },\n    accept: {\n      type: String,\n      default: '.xls,.xlsx'\n    },\n    dialogVisible: {\n      type: Boolean,\n      default: false\n    },\n    type: {\n      type: String,\n      default: 'add'\n    }\n  },\n  data() {\n    return {\n      model: this.initImport(),\n      screenWidth: 0,\n      width: this.initWidth(),\n      fileLength: 0,\n      disabled: false,\n      rules: {\n        fileLength: {\n          required: true, trigger: \"change\",\n          validator: (rule, value, callback) => {\n            const vm = this;\n            if (vm.fileLength === 0) {\n              callback(new Error(\"请上传文件\"))\n            } else if (vm.fileLength > 1) {\n              callback(new Error(\"一次性只能上传1个文件\"))\n            } else {\n              callback()\n            }\n          }\n        }\n      }\n    }\n  },\n  computed: {\n    isVisible: {\n      get() {\n        return this.dialogVisible\n      },\n      set() {\n        this.close()\n        this.reset()\n      }\n    },\n    title() {\n      return this.$t('common.upload')\n    }\n  },\n  watch: {},\n  mounted() {\n    window.onresize = () => {\n      return (() => {\n        this.width = this.initWidth()\n      })()\n    }\n  },\n  methods: {\n    initImport() {\n      return {\n        id: '',\n        bizId: '',\n        bizType: '',\n        file: null,\n        isSingle: false\n      }\n    },\n    handleDrag() {\n    },\n    // 附件长度校验\n    fileLengthVaild(data) {\n      const vm = this;\n      vm.fileLength = data || 0;\n    },\n    initWidth() {\n      this.screenWidth = document.body.clientWidth\n      if (this.screenWidth < 991) {\n        return '90%'\n      } else if (this.screenWidth < 1400) {\n        return '45%'\n      } else {\n        return '800px'\n      }\n    },\n    setModel(val) {\n      const vm = this\n      if (val) {\n        vm.model = {...val}\n      }\n    },\n    close() {\n      this.$emit('close')\n    },\n    reset() {\n      // 先清除校验，再清除表单，不然有奇怪的bug\n      this.$refs.form.clearValidate()\n      this.$refs.form.resetFields()\n      this.disabled = false;\n      this.model = this.initImport()\n      this.$refs.fileRef.init({\n        id: \"\"\n      })\n    },\n    submitForm() {\n      const vm = this\n      this.$refs.form.validate((valid) => {\n        if (valid) {\n          vm.editSubmit()\n        } else {\n          return false\n        }\n      })\n    },\n    editSubmit() {\n      const vm = this\n      vm.disabled = true\n      vm.$refs.fileRef.submitFile(this.model.id, this.model.bizId, this.model.bizType)\n    },\n    setIdAndSubmit(isUploadCompleted, response) {\n      const vm = this\n      if (isUploadCompleted) {\n        vm.disabled = false\n        vm.isVisible = false\n        vm.$message({\n          message: vm.$t('tips.createSuccess'),\n          type: 'success'\n        })\n        vm.$emit('success')\n      } else if (response && response['code'] === -9 && response['data']) {\n        // 原本是想要下载数据，但存在一些问题\n        // commonApi.export(this.exportErrorUrl, {failList: response['data']})\n        //   .then(response => {\n        //   downloadFile(response);\n        // });\n      }\n    }\n  }\n}\n",null]}