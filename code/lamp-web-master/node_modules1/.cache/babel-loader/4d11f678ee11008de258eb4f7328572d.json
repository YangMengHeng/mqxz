{"remainingRequest":"C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\src\\views\\lamp\\system\\menu\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\src\\views\\lamp\\system\\menu\\index.vue","mtime":1679380940000},{"path":"C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\babel.config.js","mtime":1679380940000},{"path":"C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686711136315},{"path":"C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1686711135008},{"path":"C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1686711137609},{"path":"C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686711136315},{"path":"C:\\Users\\Planck\\Desktop\\mycode\\lamp\\lamp-web-master\\node_modules\\vue-loader\\lib\\index.js","mtime":1686711137115}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.array.sort\";\nimport _defineProperty from \"C:/Users/Planck/Desktop/mycode/lamp/lamp-web-master/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es6.string.starts-with\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es6.string.ends-with\";\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport commonTree from '@/components/lamp/CommonTree.vue';\nimport Icons from \"./icons\";\nimport ResourceEdit from \"./edit\";\nimport Pagination from '@/components/Pagination';\nimport elDragDialog from '@/directive/el-drag-dialog';\nimport menuApi from '@/api/Menu.js';\nimport resourceApi from '@/api/Resource.js';\nimport { initQueryParams } from '@/utils/commons';\nexport default {\n  name: 'MenuManage',\n  directives: {\n    elDragDialog: elDragDialog\n  },\n  components: {\n    Icons: Icons,\n    commonTree: commonTree,\n    Pagination: Pagination,\n    ResourceEdit: ResourceEdit\n  },\n  data: function data() {\n    var _this = this;\n    return {\n      dialog: {\n        isVisible: false,\n        type: 'add'\n      },\n      preview: {\n        isVisible: false,\n        context: ''\n      },\n      iconVisible: false,\n      menuTree: [],\n      label: '',\n      menu: this.initMenu(),\n      resourceQueryParams: initQueryParams({\n        model: {\n          menuId: null\n        }\n      }),\n      resourceTableKey: 0,\n      resourceLoading: false,\n      resourceSelection: [],\n      resourceTableData: {\n        total: 0\n      },\n      rules: {\n        label: [{\n          required: true,\n          message: this.$t('rules.require'),\n          trigger: 'blur'\n        }, {\n          min: 1,\n          max: 255,\n          message: this.$t('rules.range2to10'),\n          trigger: 'blur'\n        }],\n        path: [{\n          max: 255,\n          message: this.$t('rules.noMoreThan100'),\n          trigger: 'blur'\n        }, {\n          required: true,\n          message: this.$t('rules.require'),\n          trigger: 'blur'\n        }, {\n          validator: function validator(rule, value, callback) {\n            var isUrl = _this.isUrl(_this.menu.path);\n            if (value === '/' || !isUrl && value.endsWith('/')) {\n              callback('请填写有效的路由地址');\n            } else {\n              callback();\n            }\n          },\n          trigger: 'blur'\n        }]\n      }\n    };\n  },\n  computed: {\n    menuComponent: function menuComponent() {\n      var comp = '';\n      if (this.menu.path && this.menu.path !== '/') {\n        var isUrl = this.isUrl(this.menu.path);\n        if (isUrl) {\n          comp = \"\\u8DF3\\u8F6C\\u5730\\u5740\\uFF1A\".concat(this.menu.path);\n        } else {\n          comp = \"\\u7EC4\\u4EF6\\u8DEF\\u5F84\\uFF1Asrc/views/\".concat(this.menu.component, \".vue\");\n        }\n      } else {\n        comp = \"\\u7EC4\\u4EF6\\u8DEF\\u5F84\\uFF1Asrc/views/lamp/index.vue\";\n      }\n      return comp;\n    }\n  },\n  watch: {\n    'menu.path': function menuPath() {\n      this.computedComponent();\n    }\n  },\n  mounted: function mounted() {\n    this.initMenuTree();\n  },\n  methods: {\n    isUrl: function isUrl(path) {\n      var urls = ['http://', '/http://', 'https://', '/https://', 'www.', '/www.'];\n      var urlIndex = urls.findIndex(function (item) {\n        return path.startsWith(item);\n      });\n      return urlIndex >= 0;\n    },\n    menuPath: function menuPath() {\n      var isUrl = this.isUrl(this.menu.path);\n      if (!isUrl && !this.menu.path.startsWith('/')) {\n        this.menu.path = '/' + this.menu.path;\n      } else if (isUrl) {\n        if (this.menu.path.startsWith('/')) {\n          this.menu.path = this.menu.path.substr(1);\n        }\n      }\n    },\n    computedComponent: function computedComponent() {\n      var isUrl = this.isUrl(this.menu.path);\n      if (isUrl) {\n        this.menu.component = 'Layout';\n      } else if (this.menu.id === \"\") {\n        if (this.menu.path) {\n          this.menu.component = \"lamp\".concat(this.menu.path, \"/index\");\n        } else {\n          this.menu.component = \"lamp/index\";\n        }\n      }\n    },\n    initMenuTree: function initMenuTree() {\n      var _this2 = this;\n      menuApi.allTree().then(function (response) {\n        var res = response.data;\n        _this2.menuTree = res.data;\n      });\n    },\n    initMenu: function initMenu() {\n      return {\n        id: '',\n        label: '',\n        describe: '',\n        code: '',\n        isGeneral: false,\n        path: '',\n        component: '',\n        state: true,\n        sortValue: '',\n        parentId: 0,\n        icon: '',\n        group: ''\n      };\n    },\n    nodeClick: function nodeClick(data) {\n      this.menu = _objectSpread({}, data);\n      this.$refs.form.clearValidate();\n      this.resourceQueryParams.model.menuId = data.id;\n      this.resourceSearch();\n    },\n    handleNumChange: function handleNumChange(val) {\n      this.menu.sortValue = val;\n    },\n    chooseIcons: function chooseIcons() {\n      this.iconVisible = true;\n    },\n    chooseIcon: function chooseIcon(icon) {\n      this.menu.icon = icon;\n      this.iconVisible = false;\n    },\n    submit: function submit() {\n      var _this3 = this;\n      this.$refs.form.validate(function (valid) {\n        if (valid) {\n          _this3.menu.createTime = _this3.menu.updateTime = null;\n          if (_this3.menu.id) {\n            _this3.update();\n          } else {\n            _this3.save();\n          }\n        } else {\n          return false;\n        }\n      });\n    },\n    save: function save() {\n      var _this4 = this;\n      console.log(this.menu.component);\n      menuApi.save(this.menu).then(function (response) {\n        var res = response.data;\n        if (res.isSuccess) {\n          _this4.$message({\n            message: _this4.$t('tips.createSuccess'),\n            type: 'success'\n          });\n        }\n        _this4.reset();\n      });\n    },\n    update: function update() {\n      var _this5 = this;\n      console.log(this.menu);\n      menuApi.update(this.menu).then(function (response) {\n        var res = response.data;\n        if (res.isSuccess) {\n          _this5.$message({\n            message: _this5.$t('tips.updateSuccess'),\n            type: 'success'\n          });\n        }\n        _this5.reset();\n      });\n    },\n    reset: function reset() {\n      this.initMenuTree();\n      this.label = '';\n      this.resetForm();\n    },\n    search: function search() {\n      this.$refs.menuTree.$refs.treeRef.filter(this.label);\n    },\n    add: function add() {\n      this.resetForm();\n      var checked = this.$refs.menuTree.$refs.treeRef.getCheckedKeys();\n      if (checked.length > 1) {\n        this.$message({\n          message: this.$t('tips.onlyChooseOne'),\n          type: 'warning'\n        });\n      } else if (checked.length > 0) {\n        this.menu.parentId = checked[0];\n      } else {\n        this.menu.parentId = 0;\n      }\n      this.resourceQueryParams.model.menuId = null;\n      this.resourceReset();\n    },\n    deleteMenu: function deleteMenu() {\n      var _this6 = this;\n      var checked = this.$refs.menuTree.$refs.treeRef.getCheckedKeys();\n      if (checked.length === 0) {\n        this.$message({\n          message: this.$t('tips.noNodeSelected'),\n          type: 'warning'\n        });\n      } else {\n        this.$confirm(this.$t('tips.confirmDeleteNode'), this.$t('common.tips'), {\n          confirmButtonText: this.$t('common.confirm'),\n          cancelButtonText: this.$t('common.cancel'),\n          type: 'warning'\n        }).then(function () {\n          menuApi.delete(checked).then(function (response) {\n            var res = response.data;\n            if (res.isSuccess) {\n              _this6.$message({\n                message: _this6.$t('tips.deleteSuccess'),\n                type: 'success'\n              });\n            }\n            _this6.reset();\n            _this6.resourceQueryParams.model.menuId = null;\n            _this6.resourceReset();\n          });\n        }).catch(function () {\n          _this6.$refs.menuTree.$refs.treeRef.setCheckedKeys([]);\n        });\n      }\n    },\n    resetForm: function resetForm() {\n      this.$refs.form.clearValidate();\n      this.$refs.form.resetFields();\n      this.menu = this.initMenu();\n    },\n    resourceAdd: function resourceAdd() {\n      this.dialog.type = 'add';\n      this.dialog.isVisible = true;\n      this.$refs.resourceEdit.setResource({\n        menuId: this.menu.id\n      });\n    },\n    resourceEdit: function resourceEdit(row) {\n      this.dialog.type = 'edit';\n      this.dialog.isVisible = true;\n      row.menuId = this.menu.id;\n      this.$refs.resourceEdit.setResource(row);\n    },\n    resourceSingleDelete: function resourceSingleDelete(row) {\n      this.$refs.resourceTable.clearSelection();\n      this.$refs.resourceTable.toggleRowSelection(row, true);\n      this.resourceBatchDelete();\n    },\n    resourceBatchDelete: function resourceBatchDelete() {\n      var _this7 = this;\n      if (!this.resourceSelection.length) {\n        this.$message({\n          message: this.$t('tips.noDataSelected'),\n          type: 'warning'\n        });\n        return;\n      }\n      this.$confirm(this.$t('tips.confirmDeleteNode'), this.$t('common.tips'), {\n        confirmButtonText: this.$t('common.confirm'),\n        cancelButtonText: this.$t('common.cancel'),\n        type: 'warning'\n      }).then(function () {\n        var ids = _this7.resourceSelection.map(function (item) {\n          return item.id;\n        });\n        resourceApi.delete(ids).then(function (response) {\n          var res = response.data;\n          if (res.isSuccess) {\n            _this7.$message({\n              message: _this7.$t('tips.deleteSuccess'),\n              type: 'success'\n            });\n          }\n          _this7.resourceReset();\n        });\n      });\n    },\n    resourceReset: function resourceReset() {\n      this.resourceQueryParams = initQueryParams({\n        model: {\n          menuId: this.resourceQueryParams.menuId\n        }\n      });\n      this.$refs.resourceTable.clearSort();\n      this.$refs.resourceTable.clearFilter();\n      this.resourceSearch();\n    },\n    resourceSearch: function resourceSearch() {\n      this.resourceFetch(_objectSpread({}, this.resourceQueryParams));\n    },\n    resourceFetch: function resourceFetch() {\n      var _this8 = this;\n      var params = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      if (this.resourceQueryParams.timeRange) {\n        this.resourceQueryParams.extra.createTime_st = this.queryParams.timeRange[0];\n        this.resourceQueryParams.extra.createTime_ed = this.queryParams.timeRange[1];\n      }\n      this.resourceQueryParams.current = params.current ? params.current : this.resourceQueryParams.current;\n      this.resourceQueryParams.size = params.size ? params.size : this.resourceQueryParams.size;\n      if (this.resourceQueryParams.model.menuId) {\n        this.resourceLoading = true;\n        resourceApi.page(this.resourceQueryParams).then(function (response) {\n          var res = response.data;\n          if (res.isSuccess) {\n            _this8.resourceTableData = res.data;\n          }\n        }).finally(function () {\n          return _this8.resourceLoading = false;\n        });\n      } else {\n        this.resourceTableData = {};\n      }\n    },\n    resourceSortChange: function resourceSortChange(val) {\n      this.resourceQueryParams.sort = val.prop;\n      this.resourceQueryParams.order = val.order;\n      if (this.resourceQueryParams.sort) {\n        this.resourceSearch();\n      }\n    },\n    resourceFilterChange: function resourceFilterChange(filters) {\n      for (var key in filters) {\n        if (key.includes('.')) {\n          var val = {};\n          val[key.split('.')[1]] = filters[key][0];\n          this.resourceQueryParams.model[key.split('.')[0]] = val;\n        } else {\n          this.resourceQueryParams.model[key] = filters[key][0];\n        }\n      }\n      this.resourceSearch();\n    },\n    onResourceSelectChange: function onResourceSelectChange(selection) {\n      this.resourceSelection = selection;\n    },\n    resourceEditClose: function resourceEditClose() {\n      this.dialog.isVisible = false;\n    },\n    resourceEditSuccess: function resourceEditSuccess() {\n      this.resourceSearch();\n    }\n  }\n};",null]}