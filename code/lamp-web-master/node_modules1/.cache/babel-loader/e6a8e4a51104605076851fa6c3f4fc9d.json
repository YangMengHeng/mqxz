{"remainingRequest":"E:\\project\\lamp-web-master\\node_modules\\babel-loader\\lib\\index.js!E:\\project\\lamp-web-master\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\project\\lamp-web-master\\src\\api\\AxiosApi.js","dependencies":[{"path":"E:\\project\\lamp-web-master\\src\\api\\AxiosApi.js","mtime":1689665117767},{"path":"E:\\project\\lamp-web-master\\babel.config.js","mtime":1679380940000},{"path":"E:\\project\\lamp-web-master\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1686711136315},{"path":"E:\\project\\lamp-web-master\\node_modules\\babel-loader\\lib\\index.js","mtime":1686711137609},{"path":"E:\\project\\lamp-web-master\\node_modules\\eslint-loader\\index.js","mtime":1686711135831}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"E:/project/lamp-web-master/node_modules/@babel/runtime/helpers/interopRequireDefault.js\");\nrequire(\"core-js/modules/es7.object.get-own-property-descriptors\");\nrequire(\"core-js/modules/es6.object.keys\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nrequire(\"core-js/modules/es7.object.entries\");\nrequire(\"core-js/modules/web.dom.iterable\");\nvar _defineProperty2 = _interopRequireDefault(require(\"E:/project/lamp-web-master/node_modules/@babel/runtime/helpers/defineProperty.js\"));\nrequire(\"core-js/modules/es7.array.includes\");\nvar _axios = _interopRequireDefault(require(\"axios\"));\nvar _elementUi = require(\"element-ui\");\nvar _localstorage = _interopRequireDefault(require(\"@/utils/localstorage\"));\nvar _index = _interopRequireDefault(require(\"@/router/index\"));\nvar _jsBase = require(\"js-base64\");\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }\n//-----------------------------------------------------------------------\n// npm run serve 启动项目 当前是本地开发环境\nif (process.env.NODE_ENV === \"development\") {\n  _axios.default.defaults.baseURL = process.env.VUE_APP_BASE_API; //  '/dev-api'\n} else {\n  // 如果是生产环境本地代理无作用 ， 代理只对本地运行有效\n  _axios.default.defaults.baseURL = process.env.VUE_APP_REQUEST_URL; // 'http://192.168.1.242'\n}\n\nconsole.log(_axios.default.defaults.baseURL); //  '/dev-api'\n//-------------------------------------------------------------------------\n\n// 请求添加条件，如token\n_axios.default.interceptors.request.use(function (config) {\n  var isToken = config.headers['X-isToken'] === false ? config.headers['X-isToken'] : true;\n  var token = _localstorage.default.get('TOKEN', '');\n  if (token && isToken) {\n    config.headers.token = 'Bearer ' + token;\n  }\n  var isTenant = config.headers['X-isTenant'] === false ? config.headers['X-isTenant'] : true;\n  if (isTenant && process.env.VUE_APP_IS_MULTI_TENANT_TYPE !== \"NONE\") {\n    config.headers.tenant = _localstorage.default.get('TENANT', '');\n  }\n  var clientId = process.env.VUE_APP_CLIENT_ID;\n  var clientSecret = process.env.VUE_APP_CLIENT_SECRET;\n  config.headers['Authorization'] = \"Basic \".concat(_jsBase.Base64.encode(\"\".concat(clientId, \":\").concat(clientSecret)));\n\n  // 当前请求地址#号后的路径，需要用户后台判断该页面的数据权限\n\n  config.headers['Path'] = _index.default && _index.default.history && _index.default.history.current ? _index.default.history.current.fullPath : '';\n\n  // 灰度参数，后台服务集群启动时，可以通过该参数固定请求某个节点！\n  config.headers['gray_version'] = 'zuihou';\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\n\n// 接口返回处理\n_axios.default.interceptors.response.use(function (response) {\n  return response;\n}, function (error) {\n  return Promise.reject(error);\n});\nfunction handleError(error, reject, opts) {\n  debugger;\n  var isAlert = opts.custom ? opts.custom['isAlert'] : true;\n  isAlert = isAlert === undefined ? true : isAlert;\n  if (isAlert) {\n    if (error.code === 'ECONNABORTED') {\n      (0, _elementUi.Message)({\n        message: '请求超时'\n      });\n    } else if (error.response && error.response.data) {\n      var resData = error.response.data;\n      if (error.response.status === 403 || error.response.status === 401) {\n        _elementUi.MessageBox.alert(resData.msg || '登录已失效，请重新登录', '提醒', {\n          confirmButtonText: '确定',\n          callback: function callback() {\n            _localstorage.default.clear();\n            window.location.hash = '/login';\n          }\n        });\n      } else if (error.response.status === 500) {\n        (0, _elementUi.Message)({\n          message: error.response.data\n        });\n      } else {\n        var _resData = error.response.data;\n        if (_resData.code === 40000 || _resData.code === 40001 || _resData.code === 40002 || _resData.code === 40003 || _resData.code === 40005 || _resData.code === 40006 || _resData.code === 40008 || _resData.code === 40009) {\n          _elementUi.MessageBox.alert(_resData.msg || _resData.message, '提醒', {\n            confirmButtonText: '确定',\n            callback: function callback() {\n              _localstorage.default.clear();\n              window.location.hash = '/login';\n            }\n          });\n        } else if (_resData.msg) {\n          (0, _elementUi.Message)({\n            message: _resData.msg\n          });\n        } else if (_resData.message) {\n          (0, _elementUi.Message)({\n            message: _resData.message\n          });\n        }\n      }\n    } else if (error.message) {\n      (0, _elementUi.Message)({\n        message: error.message\n      });\n    }\n  }\n  reject(error);\n}\nfunction handleSuccess(res, resolve, opts) {\n  var isAlert = opts.custom ? opts.custom['isAlert'] : true;\n  isAlert = isAlert === undefined ? true : isAlert;\n  var resData = res.data;\n  if (resData.isSuccess === false) {\n    // 未登录\n    if (resData.code === 40000 || resData.code === 40001 || resData.code === 40002 || resData.code === 40003 || resData.code === 40005 || resData.code === 40006 || resData.code === 40008) {\n      debugger;\n      _elementUi.MessageBox.alert(resData.msg, '提醒', {\n        confirmButtonText: '确定',\n        callback: function callback() {\n          window.location.hash = '/login';\n        }\n      });\n    } else {\n      if (isAlert) {\n        _elementUi.Message.error(resData.msg);\n      }\n    }\n  }\n  resolve(res);\n}\n\n// http请求\nvar httpServer = function httpServer(opts) {\n  // 公共参数\n  var publicParams = {\n    ts: Date.now()\n  };\n\n  // http默认配置\n  var method = opts.method.toUpperCase();\n  // baseURL\n  // 开发环境： /api                 // 开发环境在 vue.config.js 中有 devServer.proxy 代理\n  // 生产环境： http://IP:PORT/api   // 生产环境中 代理失效， 故需要配置绝对路径\n  var httpDefaultOpts = {\n    method: method,\n    baseURL: process.env.VUE_APP_PROD_REQUEST_DOMAIN_PREFIX + process.env.VUE_APP_BASE_API,\n    url: opts.url,\n    responseType: opts.responseType || '',\n    timeout: opts.custom && opts.custom['timeout'] || 30000\n  };\n  if (opts['meta']) {\n    httpDefaultOpts.headers = opts['meta'];\n  }\n  var dataRequest = ['PUT', 'POST', 'DELETE', 'PATCH'];\n  if (dataRequest.includes(method)) {\n    httpDefaultOpts.data = opts.data || {};\n    httpDefaultOpts.params = publicParams;\n  } else {\n    httpDefaultOpts.params = _objectSpread(_objectSpread({}, publicParams), opts.data || {});\n  }\n\n  // formData转换\n  if (opts.formData) {\n    httpDefaultOpts.transformRequest = [function (data) {\n      var formData = new FormData();\n      if (data) {\n        Object.entries(data).forEach(function (item) {\n          formData.append(item[0], item[1]);\n        });\n      }\n      return formData;\n    }];\n  }\n  var promise = new Promise(function (resolve, reject) {\n    (0, _axios.default)(httpDefaultOpts).then(function (response) {\n      handleSuccess(response, resolve, opts);\n    }).catch(function (error) {\n      handleError(error, reject, opts);\n    });\n  });\n  return promise;\n};\nvar _default = httpServer;\nexports.default = _default;",null]}